<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	<meta content='width=device-width' name='viewport'>
  <meta name="theme-color" content="#222222">
  <link rel="shortcut icon" href="favicon.png">
	<title>Install WLED</title>
  <script
    type="module"
    src="installer/install-button.js"
  ></script>
  <script>
    var eraseFlash = true;
    function toggleErase() {
      if (document.getElementById('erase').checked) {
        //document.getElementById('inst').setAttribute('erase-first','');
        eraseFlash = true;
      } else {
        //document.getElementById('inst').removeAttribute('erase-first');
        eraseFlash = false;
      }
    }

    var tm;
    var totalBytes = 724800;
    var writtenBytes = 0;
    
    function setProgress(i) {
      writtenBytes += 7249;
      if (i != 0) {
        i = Math.floor((writtenBytes / totalBytes)*100);
      }
      
      if (i > 100) i = 100;
      document.getElementById('progress').textContent = i + "%";
      var a = (i < 50) ? 1.0 : 1.0 - (i-50)*0.02;
      document.getElementById('bar-inner').style.transform = `translate(-${(100-i)/2}%,-10%)`
      document.getElementById('bar-inner').style.background = `linear-gradient(to right, rgba(255,255,255,${a}) 50%, #444 50%)`;
      document.getElementById('extra').textContent = `${(writtenBytes/1000).toFixed(1)} / ${(totalBytes/1000).toFixed(1)}k`
      if (i >= 100) {
        document.getElementById('state').textContent = "Done!";
        document.getElementById('extra').textContent = "Unplug/reset device";
        document.getElementById('progress').innerHTML = "<a class='clickable' onclick='reset()'>&#8635; Start over</a>";
        clearInterval(tm);
      }
    }
    
    function reset() {
      document.getElementsByClassName('inst-button')[0].style.display = "block";
      document.getElementsByClassName('log')[0].style.display = "none";
    }
    
    function mockup() {
      document.getElementsByClassName('inst-button')[0].style.display = "none";
      document.getElementsByClassName('log')[0].style.display = "block";
      setProgress(0);
      writtenBytes = 0;
      document.getElementById('state').textContent = "Initializing...";
      document.getElementById('progress').textContent = "0%";
      document.getElementById('env').textContent = "";
      document.getElementById('extra').innerHTML = "&nbsp;";
      //alert('This is just a non-functional mockup. You would select the serial port at this point.')
      
      setTimeout(step1, 2400);
    }
    
    //init found board type
    function step1() {
      document.getElementById('env').textContent = "ESP8266";
      setTimeout(step2, 900);
    }
    
    //erase, only if activated. Also add firmware name from manifest.json
    function step2() {
      if (!eraseFlash) {step3(); return;}
      document.getElementById('state').textContent = "Erasing...";
      document.getElementById('env').textContent = "WLED 0.12.0 - ESP8266";
      setTimeout(step3, 3000);
    }
    
    function step3() {
      document.getElementById('state').textContent = "Writing...";
      document.getElementById('env').textContent = "WLED 0.12.0 - ESP8266";
      setProgress(0);
      tm = setInterval(setProgress,200);
    }

    //setProgress(0);
    //setInterval(setProgress,210);
  </script>
	<style>
		body {
			font-family: Verdana, Helvetica, sans-serif;
			text-align: center;
			background-color: #222;
			margin: 0;
      color: #fff;
		}
    
    .sub {
      margin: -18px 0 18px 0;
      color: #09f;
    }
    
    .btn {
      outline: none;
      cursor: pointer;
      padding: 8px;
      margin: 10px;
      width: 230px;
      font-family: Verdana, Helvetica, sans-serif;
      font-size: 19px;
      background-color: #333;
      color: white;
      border: 0px solid white;
      border-radius: 25px;
    }
    
    .clickable {
      cursor: pointer;
    }
    
    esp-web-flash-log {
      margin: 16px auto 0 auto;
    }

    img {
      width: 800px;
      max-width: 85%;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      margin: 25px 0 -10px 0;
      animation: fi 1s;
    }
    
    @keyframes fi {
    from { opacity: 0; }
    to   { opacity: 1; }
    }
    
    .main {
      animation: fi 1.5s .7s both;
    }
    
    a {
      color: #fff;
    }
    
    ol {
      margin: auto;
      text-align: left;
      display: inline-block;
    }
    
    li::marker {
      text-decoration: bold;
      color: #09f;
    }
    
    li {
      margin: 5px;
    }
    
    .container {
      width: 80%;
      height: 98px;
      max-width: 510px;
      margin: auto;
      border-radius: 5px;
      box-sizing: border-box;
      background-color: #222;
      overflow: hidden;
    }
    
    .inst-button {
      padding: 5px 0;
    }

    .log {
      padding: 6px 20px 8px 20px;
      display: none;
    }

    .info-top {
      font-size: 32px;
      display: inline-block;
    }
    .info-bot {
      display: inline-block;
    }

    #state {
      float: left;
    }

    #progress {
      float: right;
    }

    #bar {
      height: 12px;
      width: 100%;
      margin: 26px 0 8px 0;
      border-radius: 25px;
      background: linear-gradient(to right, red, orange , yellow, #0a0, cyan, #09f);
      overflow: hidden;
      position: relative;
    }

    #bar-inner {
      transform: translate(-50%,-10%);
      width: 200%;
      height: 120%;
      background: linear-gradient(to right, #fff 50%, #444 50%);
      transition: transform 1s;
      position: absolute;
      left: 0;
      top: 0;
    }

    #env {
      float: left;
    }

    #extra {
      float: right;
    }


	</style>
</head>
<body>
<img alt="" src=" data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAAAjCAYAAACjOOUsAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsAAAA7AAWrWiQkAAATfSURBVGhD7ZlPaBVHHMdnS2Ox5iKYGIyYJwQlUTHG6kUwtSAIBsEiBopgKR5i68mbIPgEwZun0uYgouIlobQIKQheIsSLaBSaRFoEc3gtMa9HLaiH7X4n81tn583u/HkTaZ/7gR+zMzvv93bfZ3/777GSkpL/AJFo3Tg/H7OuPtGxY7CTsZnjkd/3lRTi/qMKgfGXt8TAO6KfT2TG1f7u6ROlyBXgI9HaQRW4+JR3ox92Z1p1XO3PLCUVORHHvFMSDDeJBuJvH4mlZdS+C3c7B+Ln3fvivw59w0MMOzP/FYvj75K4PMhDDDszdbM7rk1V4hcPD/MQw858MbEnPvJgf3x29hQPMdwUbqc2qRIhCBVGrQk+Lzm9mq6NkIe2t20N7xOf7NjK2w13rlltM+Sh7VvLu+/YOMib6NyMVR7IQ9u7qY33ibb2bbxd/9mvVnkgD217ZTXvE72fbuHtle1X3VxIuH1QOZ2mmG5yaH4yr0giBKryVCDTJBICG+SpJDJNIiFQlacCmSaREKjKU4FMX5F+p1NIk8OExTwbgeD1b7+zotOrlUBQm2FFp1cbgeDtyzlWdHq1EQie/fMH8z29Br0myiwdr7PkWpSGC2se/8IqtWnRa+y7Ur+Q3FF97/X7ZFjV/4B1Dz1Pw5WrlZ/Y7T330gjFikkE9Xo9jSJ0Vah+Ru7nVWNRFWq3Iacai6qQ9kfOl1eNuirUfZ7wrcbgEqkCOyc6MmEDVdyrXUd5ENR3rUiqwI6LnTx8oQp8M783E66cWjiWCarMZlnRSix5PwSTSBXY0WFXdf9HfK+FKlSBoX6rjEQ8XMutD3nn+1Yg5L755Mrzk0qkh2xMwLOYr0iXa6CJZu9KQ+N7LSSoAuma6EKRn1TiwaUn0bO3r/gy7v42/3nf+cEzxFGq5jD1TYTYJhAqj4pt3iI/mdMpTbQRqD4HhqhA9S40r28L3ZWmz4kUjlAFNvucSNBzomtF5vlJJVarVb53mMgHLMBRRBEaNWez3xFqW5vN0+znyQ/5Ahlho6OjcVdXl+jxiVmhHn8Gq+jendq+cpPRvUO1fuUmo3mHavvKTUb3DtX2lZtM3jtUWRqQ3TRMBrLMjMgVkAiB2waX/1nwgURygTv885BICOzrH+BjPpBICBzo38nHfJBFksDFxUU2NjaWjhMNAwSJ1Ems/n2RDQ0NsQNzn4sVjF1vvyGWGOvp6cmsk+frJLpWISFXo1cVElI1+lQhIVejTxUSajVCYp5AoB0k6AhIRQqJo7OnGRe87gIfxl9N1Y8nlpcTKpUK+/rlSdFLDghpft5fUTho0GJD5WW0RetUWi1PgwMNmbtTFdhXaRBowdj2H3kuVGQeyIkg5GVQtE6mFfPoPMgUSqSjgo4Gdqk/whfxpGeSaqJIxjFGsbCwkF2fBHJh3ZH5RpE2RxtBedJtkmi1PLSMdXwgh0KJAIkBEiLQV5MODw9ndiBvp/I2VIwZd5T4EPJQLvRNGCVSYgr0xSotIyMjYkkPfV7eUFNOHa2cx+X3BkaJAIkoxJAWCBwfHxc9PdhBbFzSRgixzHfahVbNA2x/b8JKoi0QaKpE7KC8cVjGmOha06p5fAgq0aYSS8ITROLk5GRUq9UyAt/XUVgSGNyl0kNrMyBHchCUeSwJejotKSkp+VBh7F9fIy7OdlOyMwAAAABJRU5ErkJggg==">
<div class="main">
<h2>Welcome to the WLED web installer!</h2>
<div class="sub">mockup</div>

<div class="container inst-button">
  <button class="btn" onclick="mockup()">Install</button><br>
  <input type="checkbox" id="erase" name="erase" onchange="toggleErase()" checked>
  <label for="erase"> Clean install (deletes presets and settings)</label><br>
</div>

<div class="container log">
  <span class="info-top" id="state">Initializing...</span>
  <span class="info-top" id="progress"></span><br>
  <div id="bar"><div id="bar-inner"></div></div>
  <span class="info-bot" id="env">&nbsp;</span>
  <span class="info-bot" id="extra">&nbsp;</span>
</div>
<br>
Powered by <a href="https://esphome.github.io/esp-web-tools/" target="_blank">ESP Web Tools</a>
</body>
</html>